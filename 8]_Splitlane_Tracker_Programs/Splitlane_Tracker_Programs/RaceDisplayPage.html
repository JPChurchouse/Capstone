<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      color: white;
      background-color: #000000;
      /* Use a hex color code */
    }

    h1 {
      font-family: Arial, sans-serif;
      /* Change the font family */
      text-align: center;
      /* Change the alignment */
    }

    h2 {
      font-family: Arial, sans-serif;
      /* Change the font family */
      text-align: center;
      /* Change the alignment */
    }

    table {
      border-collapse: collapse;
      text-align: center;
      margin: 0 auto;
      width: 90%;
    }

    th,
    td {
      border: 2px solid red;
      padding: 8px;
      font-size: xx-large;
      font-family: Arial, sans-serif;
    }
  </style>

  <title>Websocket Client</title>

  <img src="Images/Logo_XKarts_Main.png" alt="Description of the image" height="200"
    style="display: block; margin: 0 auto;">

</head>

<body>
  <h1>Splitlane Tracking System</h1>
  <h2>Number of laps remaining:</h2>
  <table id="data-table">
    <thead>
      <tr>
        <th>Kart</th>
        <th>Left</th>
        <th>Right</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>

    const outputDiv = document.getElementById("output");
    const socket = new WebSocket("ws://localhost:8080");

    socket.onopen = function (event) {
      console.log("WebSocket connection established.");
    };

    socket.onmessage = function (event) {
      const receivedData = event.data;
      console.log("Received WebSocket message: " + receivedData);

      // Update the page with received data
      const messageDiv = document.createElement("div");
      messageDiv.textContent = receivedData;
      outputDiv.appendChild(messageDiv);
    };

    socket.onclose = function (event) {
      console.log("WebSocket connection closed.");
    };


    function updateTable(jsonString) {
      const jsonArray = JSON.parse(jsonString);
      const tableBody = document.querySelector('#data-table tbody');

      // Clear existing table data
      tableBody.innerHTML = '';
      /*
    Object.keys(jsonArray[0]).forEach(key => {
      const th = document.createElement('th');
      th.textContent = key;
      headerRow.appendChild(th);
    });
      */
      // Update table with new data
      jsonArray.forEach(obj => {
        const row = document.createElement('tr');

        Object.values(obj).forEach(value => {
          const cell = document.createElement('td');
          cell.textContent = value;
          row.appendChild(cell);
        });

        tableBody.appendChild(row);
      });
    }

    const myInfo = [
      { Number: "17", Left: "6", Right: "2", Total: "8" },
      { Number: "29", Left: "9", Right: "0", Total: "9" },
      { Number: "8", Left: "1", Right: "2", Total: "3" },
      { Number: "1", Left: "2", Right: "2", Total: "4" },
      { Number: "7", Left: "2", Right: "17", Total: "19" },
      { Number: "42.0", Left: "6", Right: "9", Total: "nice" }
    ]

    //const jsonData = '[{"name": "John", "age": 30, "city": "New York"}, {"name": "Jane", "age": 25, "city": "London"}]';
    const jsonData = JSON.stringify(myInfo);
    updateTable(jsonData);

  </script>
</body>

</html>